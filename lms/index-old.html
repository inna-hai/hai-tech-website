<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×”×§×•×¨×¡×™× ×©×œ×™ | HAI Tech Academy</title>
    <link rel="stylesheet" href="css/lms.css">
    <link rel="stylesheet" href="css/gamification.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="dashboard-page">
    <!-- Mobile Menu Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>
    
    <nav class="lms-navbar">
        <div class="navbar-brand">
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="×ª×¤×¨×™×˜">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <a href="../index.html">
                <img src="../images/logo.webp" alt="HAI Tech Academy" class="navbar-logo">
            </a>
        </div>
        <div class="navbar-menu" id="navbarMenu">
            <a href="index.html" class="nav-link active">×”×§×•×¨×¡×™× ×©×œ×™</a>
            <a href="catalog.html" class="nav-link">×§×˜×œ×•×’ ×§×•×¨×¡×™×</a>
            <a href="profile.html#certificates" class="nav-link">×ª×¢×•×“×•×ª</a>
        </div>
        <div class="navbar-user">
            <button class="notification-btn" id="notificationBtn" aria-label="×”×ª×¨××•×ª" aria-expanded="false">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
                <span class="notification-badge" id="notificationBadge" style="display:none">0</span>
            </button>
            
            <!-- Notifications Panel -->
            <div class="notifications-panel" id="notificationsPanel" role="dialog" aria-label="×”×ª×¨××•×ª">
                <div class="notifications-header">
                    <h3>×”×ª×¨××•×ª</h3>
                    <button class="mark-all-read" id="markAllRead">×¡××Ÿ ×”×›×œ ×›× ×§×¨×</button>
                </div>
                <div class="notifications-list" id="notificationsList">
                    <div class="notification-empty">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1.5">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <p>××™×Ÿ ×”×ª×¨××•×ª ×—×“×©×•×ª</p>
                    </div>
                </div>
            </div>
            
            <div class="user-dropdown">
                <button class="user-btn" id="userDropdownBtn" aria-expanded="false">
                    <div class="user-avatar" id="userAvatar">×</div>
                    <span class="user-name" id="userName">××•×¨×—</span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
                <div class="dropdown-menu" id="userDropdownMenu">
                    <a href="profile.html" class="dropdown-item">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        ×”×¤×¨×•×¤×™×œ ×©×œ×™
                    </a>
                    <a href="profile.html#settings" class="dropdown-item">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                        ×”×’×“×¨×•×ª
                    </a>
                    <hr>
                    <button class="dropdown-item logout-btn" onclick="LMS.logout()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        ×”×ª× ×ª×§
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <main class="dashboard-main">
        <aside class="dashboard-sidebar" id="dashboardSidebar">
            <button class="close-sidebar" id="closeSidebar" aria-label="×¡×’×•×¨ ×ª×¤×¨×™×˜">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            
            <!-- Profile Card with Gamification -->
            <div class="profile-card">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">×</div>
                    <div id="levelBadgeContainer"></div>
                </div>
                <h3 class="profile-name" id="profileName">××•×¨×—</h3>
                
                <!-- XP Progress Bar -->
                <div id="xpBarContainer"></div>
                
                <div class="profile-stats">
                    <div class="stat">
                        <span class="stat-value" id="coursesCount">0</span>
                        <span class="stat-label">×§×•×¨×¡×™×</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="hoursCount">0</span>
                        <span class="stat-label">×©×¢×•×ª ×œ××™×“×”</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="certificatesCount">0</span>
                        <span class="stat-label">×ª×¢×•×“×•×ª</span>
                    </div>
                </div>
            </div>
            
            <!-- Streak Widget -->
            <div id="streakContainer"></div>
            
            <!-- Daily Challenges -->
            <div id="dailyChallengesContainer"></div>
            
            <!-- Badges Preview -->
            <div id="badgesPreviewContainer"></div>
            
            <nav class="sidebar-nav" aria-label="× ×™×•×•×˜ ×¨××©×™">
                <a href="index.html" class="sidebar-link active" aria-current="page">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    </svg>
                    ×“×£ ×”×‘×™×ª
                </a>
                <a href="catalog.html" class="sidebar-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                    ×›×œ ×”×§×•×¨×¡×™×
                </a>
                <a href="#" class="sidebar-link" id="historyLink">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    ×”×™×¡×˜×•×¨×™×”
                </a>
                <a href="#" class="sidebar-link" id="savedLink">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                    ×©××•×¨×™×
                </a>
                <a href="profile.html#certificates" class="sidebar-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="8" r="7"></circle>
                        <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
                    </svg>
                    ×”×ª×¢×•×“×•×ª ×©×œ×™
                </a>
            </nav>
            
            <!-- Recent Activity -->
            <div class="recent-activity">
                <h4>×¤×¢×™×œ×•×ª ××—×¨×•× ×”</h4>
                <div class="activity-list" id="activityList">
                    <div class="activity-empty">
                        <p>×¢×“×™×™×Ÿ ××™×Ÿ ×¤×¢×™×œ×•×ª</p>
                    </div>
                </div>
            </div>
        </aside>
        
        <section class="dashboard-content">
            <!-- Loading State -->
            <div class="dashboard-loading" id="dashboardLoading">
                <div class="loading-spinner"></div>
                <p>×˜×•×¢×Ÿ ××ª ×”×§×•×¨×¡×™× ×©×œ×š...</p>
            </div>
            
            <!-- Main Content (hidden while loading) -->
            <div id="dashboardContent" style="display:none">
                <header class="content-header">
                    <div class="header-text">
                        <h1 id="welcomeMessage">×©×œ×•×, ××•×¨×—!</h1>
                        <p id="welcomeSubtext">×”××©×š ×××™×¤×” ×©×”×¤×¡×§×ª</p>
                    </div>
                    <div class="header-actions">
                        <a href="catalog.html" class="btn btn-primary">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            ×”×•×¡×£ ×§×•×¨×¡ ×—×“×©
                        </a>
                    </div>
                </header>
                
                <!-- Continue Learning Section -->
                <div class="continue-learning" id="continueSection" style="display: none;">
                    <h2>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        ×”××©×š ×œ×œ××•×“
                    </h2>
                    <div class="continue-card" id="continueCard">
                        <!-- Populated by JS -->
                    </div>
                </div>
                
                <!-- My Courses Section -->
                <div class="courses-section">
                    <div class="section-header">
                        <h2>×”×§×•×¨×¡×™× ×©×œ×™</h2>
                        <div class="filter-tabs" role="tablist">
                            <button class="filter-tab active" data-filter="all" role="tab" aria-selected="true">×”×›×œ</button>
                            <button class="filter-tab" data-filter="in-progress" role="tab" aria-selected="false">×‘×ª×”×œ×™×š</button>
                            <button class="filter-tab" data-filter="completed" role="tab" aria-selected="false">×”×•×©×œ××•</button>
                        </div>
                    </div>
                    
                    <div class="courses-grid" id="coursesGrid">
                        <!-- Course cards populated by JS -->
                        <div class="empty-state" id="emptyState" style="display:none">
                            <div class="empty-icon">ğŸ“š</div>
                            <h3>×¢×“×™×™×Ÿ ××™×Ÿ ×œ×š ×§×•×¨×¡×™×</h3>
                            <p>×”×ª×—×œ ×œ×œ××•×“ ×¢×›×©×™×• ×•×‘× ×” ××ª ×”×§×¨×™×™×¨×” ×©×œ×š ×‘-AI</p>
                            <a href="catalog.html" class="btn btn-primary">×’×œ×” ×§×•×¨×¡×™×</a>
                        </div>
                    </div>
                </div>
                
                <!-- Recommended Courses Section -->
                <div class="recommended-section" id="recommendedSection">
                    <div class="section-header">
                        <h2>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                            ××•××œ×¥ ×¢×‘×•×¨×š
                        </h2>
                        <a href="catalog.html" class="view-all-link">×œ×›×œ ×”×§×•×¨×¡×™× â†’</a>
                    </div>
                    <div class="recommended-grid" id="recommendedGrid">
                        <!-- Populated by JS -->
                    </div>
                </div>
                
                <!-- Learning Path Section -->
                <div class="learning-path-section" id="learningPathSection">
                    <div class="section-header">
                        <h2>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="20" x2="12" y2="10"></line>
                                <line x1="18" y1="20" x2="18" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="16"></line>
                            </svg>
                            ××¡×œ×•×œ ×”×œ××™×“×” ×©×œ×š
                        </h2>
                    </div>
                    <div class="learning-path" id="learningPath">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <script src="js/lms.js"></script>
    <script src="js/gamification.js"></script>
    <script>
        // Extended LMS Dashboard functionality
        const Dashboard = {
            // API Base URL (mock for now)
            apiBase: '/api',
            
            // Initialize dashboard
            async init() {
                // If user has token, verify it and load fresh user data
                if (LMS.getToken()) {
                    await LMS.checkAuth();
                }
                
                // Check auth - redirect if not logged in
                if (!LMS.isLoggedIn()) {
                    window.location.href = 'login.html';
                    return;
                }
                
                // Setup UI interactions
                this.setupMobileMenu();
                this.setupNotifications();
                this.setupDropdowns();
                
                // Load data
                await this.loadDashboard();
                
                // Update streak
                this.updateStreak();
                
                // Load activity feed
                this.loadActivityFeed();
                
                // Load notifications
                this.loadNotifications();
            },
            
            setupMobileMenu() {
                const menuBtn = document.getElementById('mobileMenuBtn');
                const sidebar = document.getElementById('dashboardSidebar');
                const overlay = document.getElementById('mobileOverlay');
                const closeBtn = document.getElementById('closeSidebar');
                
                const toggleMenu = (show) => {
                    sidebar.classList.toggle('visible', show);
                    overlay.classList.toggle('visible', show);
                    document.body.classList.toggle('menu-open', show);
                };
                
                menuBtn?.addEventListener('click', () => toggleMenu(true));
                closeBtn?.addEventListener('click', () => toggleMenu(false));
                overlay?.addEventListener('click', () => toggleMenu(false));
            },
            
            setupNotifications() {
                const btn = document.getElementById('notificationBtn');
                const panel = document.getElementById('notificationsPanel');
                
                btn?.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isOpen = panel.classList.toggle('visible');
                    btn.setAttribute('aria-expanded', isOpen);
                });
                
                document.addEventListener('click', (e) => {
                    if (!panel?.contains(e.target) && !btn?.contains(e.target)) {
                        panel?.classList.remove('visible');
                        btn?.setAttribute('aria-expanded', 'false');
                    }
                });
                
                document.getElementById('markAllRead')?.addEventListener('click', () => {
                    this.markAllNotificationsRead();
                });
            },
            
            setupDropdowns() {
                const userBtn = document.getElementById('userDropdownBtn');
                const userMenu = document.getElementById('userDropdownMenu');
                
                userBtn?.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isOpen = userMenu.classList.toggle('visible');
                    userBtn.setAttribute('aria-expanded', isOpen);
                });
                
                document.addEventListener('click', () => {
                    userMenu?.classList.remove('visible');
                    userBtn?.setAttribute('aria-expanded', 'false');
                });
            },
            
            async loadDashboard() {
                const loading = document.getElementById('dashboardLoading');
                const content = document.getElementById('dashboardContent');
                
                try {
                    // Update user info
                    const user = LMS.getCurrentUser();
                    this.updateUserInfo(user);
                    
                    // Load real courses from JSON
                    let courses = [];
                    try {
                        const response = await fetch('data/courses.json');
                        const data = await response.json();
                        courses = data.courses || [];
                    } catch (e) {
                        console.error('Error loading courses:', e);
                    }
                    
                    // Update stats
                    this.updateStats(courses);
                    
                    // Render courses (use real courses)
                    this.renderMyCourses(courses);
                    
                    // Load continue learning
                    this.renderContinueLearning(courses);
                    
                    // Load recommended courses
                    this.loadRecommendedCourses();
                    
                    // Load learning path
                    this.loadLearningPath();
                    
                    // Show content
                    loading.style.display = 'none';
                    content.style.display = 'block';
                    
                } catch (error) {
                    console.error('Dashboard load error:', error);
                    loading.innerHTML = `
                        <div class="error-state">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--error)" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                            <h3>×©×’×™××” ×‘×˜×¢×™× ×ª ×”×“×£</h3>
                            <p>×× × × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨</p>
                            <button class="btn btn-primary" onclick="location.reload()">× ×¡×” ×©×•×‘</button>
                        </div>
                    `;
                }
            },
            
            async fetchCourses() {
                // Try to fetch from real API
                const response = await fetch(`${this.apiBase}/courses/my`, {
                    headers: {
                        'Authorization': `Bearer ${LMS.storage.get('token') || ''}`
                    }
                });
                
                if (!response.ok) throw new Error('API not available');
                return response.json();
            },
            
            updateUserInfo(user) {
                const elements = {
                    userName: document.getElementById('userName'),
                    userAvatar: document.getElementById('userAvatar'),
                    profileName: document.getElementById('profileName'),
                    profileAvatar: document.getElementById('profileAvatar'),
                    welcomeMessage: document.getElementById('welcomeMessage')
                };
                
                const avatar = user.avatar || user.name?.charAt(0) || '×';
                const name = user.name || '××•×¨×—';
                
                if (elements.userName) elements.userName.textContent = name;
                if (elements.userAvatar) elements.userAvatar.textContent = avatar;
                if (elements.profileName) elements.profileName.textContent = name;
                if (elements.profileAvatar) elements.profileAvatar.textContent = avatar;
                
                // Personalized welcome
                const hour = new Date().getHours();
                let greeting = '×©×œ×•×';
                if (hour >= 5 && hour < 12) greeting = '×‘×•×§×¨ ×˜×•×‘';
                else if (hour >= 12 && hour < 17) greeting = '×¦×”×¨×™×™× ×˜×•×‘×™×';
                else if (hour >= 17 && hour < 21) greeting = '×¢×¨×‘ ×˜×•×‘';
                else greeting = '×œ×™×œ×” ×˜×•×‘';
                
                if (elements.welcomeMessage) {
                    elements.welcomeMessage.textContent = `${greeting}, ${name}!`;
                }
                
                // Update level
                const progress = LMS.storage.get('progress') || {};
                const completedCourses = Object.values(progress).filter(p => p.completed?.length >= 12).length;
                const levels = ['××ª×—×™×œ', '××ª×§×“×', '××•××—×”', '×××¡×˜×¨'];
                const level = levels[Math.min(completedCourses, levels.length - 1)];
                
                const profileLevel = document.getElementById('profileLevel');
                if (profileLevel) profileLevel.textContent = `×¨××ª ${level}`;
            },
            
            updateStats(courses) {
                const progress = LMS.storage.get('progress') || {};
                
                // Count completed courses
                const completedCourses = courses.filter(c => {
                    const p = progress[c.id]?.percentage || 0;
                    return p === 100;
                }).length;
                
                // Calculate total learning hours
                const totalHours = courses.reduce((acc, c) => {
                    const p = progress[c.id]?.percentage || 0;
                    const hours = c.lessonsCount * 0.5; // Estimate 30 min per lesson
                    return acc + (hours * (p / 100));
                }, 0);
                
                document.getElementById('coursesCount').textContent = courses.length;
                document.getElementById('hoursCount').textContent = Math.round(totalHours);
                document.getElementById('certificatesCount').textContent = completedCourses;
            },
            
            updateStreak() {
                const streakData = LMS.storage.get('streakData') || { count: 0, dates: [] };
                const today = new Date().toISOString().split('T')[0];
                
                // Check if already logged today
                if (!streakData.dates.includes(today)) {
                    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                    
                    if (streakData.dates.includes(yesterday)) {
                        // Continue streak
                        streakData.count++;
                    } else {
                        // Reset streak
                        streakData.count = 1;
                    }
                    
                    streakData.dates.push(today);
                    // Keep only last 30 days
                    streakData.dates = streakData.dates.slice(-30);
                    LMS.storage.set('streakData', streakData);
                }
                
                document.getElementById('streakCount').textContent = streakData.count;
                
                // Render streak calendar
                const calendar = document.getElementById('streakCalendar');
                if (calendar) {
                    const last7Days = [];
                    for (let i = 6; i >= 0; i--) {
                        const date = new Date(Date.now() - i * 86400000).toISOString().split('T')[0];
                        const dayName = new Date(date).toLocaleDateString('he-IL', { weekday: 'narrow' });
                        const isActive = streakData.dates.includes(date);
                        last7Days.push(`
                            <div class="streak-day ${isActive ? 'active' : ''}" title="${date}">
                                <span class="day-label">${dayName}</span>
                                <span class="day-dot"></span>
                            </div>
                        `);
                    }
                    calendar.innerHTML = last7Days.join('');
                }
            },
            
            renderMyCourses(courses) {
                const grid = document.getElementById('coursesGrid');
                const emptyState = document.getElementById('emptyState');
                if (!grid) return;
                
                // Color gradients
                const gradients = [
                    'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                    'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                    'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                    'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                    'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
                ];
                
                // Clear existing
                grid.querySelectorAll('.course-card').forEach(c => c.remove());
                
                if (courses.length === 0) {
                    if (emptyState) emptyState.style.display = 'block';
                    return;
                }
                
                if (emptyState) emptyState.style.display = 'none';
                
                courses.forEach((course, i) => {
                    const progress = LMS.storage.get('progress')?.[course.id]?.percentage || 0;
                    const card = document.createElement('div');
                    card.className = 'course-card';
                    card.innerHTML = `
                        <div class="course-image" style="background: ${gradients[i % gradients.length]};">
                            ${progress === 100 ? '<span class="course-badge">×”×•×©×œ× âœ“</span>' : ''}
                        </div>
                        <div class="course-content">
                            <h3>${course.title}</h3>
                            <p>${course.shortDescription || ''}</p>
                            <div class="course-meta">
                                <span>ğŸ‘¶ ×’×™×œ××™ ${course.ageRange}</span>
                                <span>ğŸ“š ${course.lessonsCount} ×©×™×¢×•×¨×™×</span>
                            </div>
                            <div class="course-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progress}%"></div>
                                </div>
                                <div class="progress-text">
                                    <span>${progress}% ×”×•×©×œ×</span>
                                </div>
                            </div>
                            <a href="course.html?id=${course.id}" class="btn btn-primary" style="width: 100%; margin-top: 12px;">
                                ${progress === 0 ? '×”×ª×—×œ ×œ×œ××•×“' : progress === 100 ? '×¦×¤×” ×©×•×‘' : '×”××©×š ×œ×œ××•×“'}
                            </a>
                        </div>
                    `;
                    grid.insertBefore(card, emptyState);
                });
            },
            
            renderContinueLearning(courses) {
                const section = document.getElementById('continueSection');
                const card = document.getElementById('continueCard');
                if (!section || !card) return;
                
                // Find course with progress
                const progress = LMS.storage.get('progress') || {};
                const inProgress = courses.filter(c => {
                    const p = progress[c.id]?.percentage || 0;
                    return p > 0 && p < 100;
                });
                
                if (inProgress.length === 0) {
                    section.style.display = 'none';
                    return;
                }
                
                section.style.display = 'block';
                const course = inProgress[0];
                const p = progress[course.id]?.percentage || 0;
                
                card.innerHTML = `
                    <div class="course-thumb" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                    <div class="continue-info">
                        <h3>${course.title}</h3>
                        <p>${p}% ×”×•×©×œ×</p>
                        <a href="course.html?id=${course.id}" class="btn btn-primary">×”××©×š ×œ×œ××•×“</a>
                    </div>
                `;
            },
            
            async loadRecommendedCourses() {
                const grid = document.getElementById('recommendedGrid');
                if (!grid) return;
                
                // Load real courses from JSON
                try {
                    const response = await fetch('data/courses.json');
                    const data = await response.json();
                    const courses = data.courses || [];
                    
                    // Color gradients for courses
                    const gradients = [
                        'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                        'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                        'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                        'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                        'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
                    ];
                    
                    grid.innerHTML = courses.map((course, i) => `
                        <div class="course-card recommended" data-course-id="${course.id}">
                            <div class="course-image" style="background: ${gradients[i % gradients.length]};">
                                ${course.featured ? '<span class="course-badge">×¤×•×¤×•×œ×¨×™</span>' : ''}
                            </div>
                            <div class="course-content">
                                <h3>${course.title}</h3>
                                <p>${course.shortDescription || course.description.substring(0, 80) + '...'}</p>
                                <div class="course-meta">
                                    <span>ğŸ‘¶ ×’×™×œ××™ ${course.ageRange}</span>
                                    <span>ğŸ“š ${course.lessonsCount} ×©×™×¢×•×¨×™×</span>
                                </div>
                                <div class="course-price">
                                    <span class="price">â‚ª${course.price}</span>
                                </div>
                                <a href="course.html?id=${course.id}" class="btn btn-outline">×”×ª×—×œ ×¢×›×©×™×•</a>
                            </div>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Error loading courses:', error);
                    grid.innerHTML = '<p>×©×’×™××” ×‘×˜×¢×™× ×ª ×”×§×•×¨×¡×™×</p>';
                }
            },
            
            async loadLearningPath() {
                const container = document.getElementById('learningPath');
                if (!container) return;
                
                // Load real courses for learning path
                try {
                    const response = await fetch('data/courses.json');
                    const data = await response.json();
                    const courses = data.courses || [];
                    
                    const icons = ['ğŸ®', 'â›ï¸', 'ğŸ¯', 'ğŸŒ', 'ğŸ¤–', 'ğŸ“±'];
                    
                    container.innerHTML = courses.slice(0, 5).map((course, i) => `
                        <div class="path-step ${i === 0 ? 'current' : 'locked'}">
                            <div class="step-icon">${icons[i % icons.length]}</div>
                            <div class="step-content">
                                <span class="step-number">×§×•×¨×¡ ${i + 1}</span>
                                <span class="step-title">${course.title}</span>
                            </div>
                            <div class="step-status">
                                ${i === 0 ? 'â–¶' : 'ğŸ”’'}
                            </div>
                            ${i < Math.min(courses.length, 5) - 1 ? '<div class="step-connector"></div>' : ''}
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Error loading learning path:', error);
                }
            },
            
            loadActivityFeed() {
                const list = document.getElementById('activityList');
                if (!list) return;
                
                const activities = LMS.storage.get('activities') || [];
                
                // Add default activities if empty
                if (activities.length === 0) {
                    activities.push(
                        { type: 'lesson', text: '×”×©×œ××ª ×©×™×¢×•×¨: ××” ×–×” ML?', time: Date.now() - 3600000 },
                        { type: 'course', text: '×”×ª×—×œ×ª ×§×•×¨×¡: Python', time: Date.now() - 86400000 },
                        { type: 'achievement', text: '×”×™×©×’ ×—×“×©: ğŸ”¥ 7 ×™××™× ×¨×¦×•×¤×™×!', time: Date.now() - 172800000 }
                    );
                }
                
                if (activities.length === 0) {
                    return;
                }
                
                list.innerHTML = activities.slice(0, 5).map(activity => {
                    const timeAgo = this.formatTimeAgo(activity.time);
                    const icons = {
                        lesson: 'ğŸ“–',
                        course: 'ğŸ“š',
                        achievement: 'ğŸ†',
                        certificate: 'ğŸ“œ'
                    };
                    
                    return `
                        <div class="activity-item">
                            <span class="activity-icon">${icons[activity.type] || 'ğŸ“'}</span>
                            <div class="activity-content">
                                <span class="activity-text">${activity.text}</span>
                                <span class="activity-time">${timeAgo}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            },
            
            loadNotifications() {
                const list = document.getElementById('notificationsList');
                const badge = document.getElementById('notificationBadge');
                
                const notifications = LMS.storage.get('notifications') || [
                    { id: 1, title: '×§×•×¨×¡ ×—×“×©!', text: '×§×•×¨×¡ ChatGPT ×œ××ª×§×“××™× ×¢×›×©×™×• ×–××™×Ÿ', time: Date.now() - 3600000, read: false },
                    { id: 2, title: '×”×™×©×’ ×—×“×©', text: '×”×©×œ××ª 10 ×©×™×¢×•×¨×™×! ğŸ‰', time: Date.now() - 86400000, read: false }
                ];
                
                const unread = notifications.filter(n => !n.read).length;
                
                if (unread > 0) {
                    badge.textContent = unread > 9 ? '9+' : unread;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
                
                if (notifications.length === 0) {
                    return;
                }
                
                list.innerHTML = notifications.map(notif => `
                    <div class="notification-item ${notif.read ? 'read' : 'unread'}" data-id="${notif.id}">
                        <div class="notification-content">
                            <strong>${notif.title}</strong>
                            <p>${notif.text}</p>
                            <span class="notification-time">${this.formatTimeAgo(notif.time)}</span>
                        </div>
                    </div>
                `).join('');
                
                // Click to mark as read
                list.querySelectorAll('.notification-item.unread').forEach(item => {
                    item.addEventListener('click', () => {
                        const id = parseInt(item.dataset.id);
                        this.markNotificationRead(id);
                    });
                });
            },
            
            markNotificationRead(id) {
                const notifications = LMS.storage.get('notifications') || [];
                const notif = notifications.find(n => n.id === id);
                if (notif) {
                    notif.read = true;
                    LMS.storage.set('notifications', notifications);
                    this.loadNotifications();
                }
            },
            
            markAllNotificationsRead() {
                const notifications = LMS.storage.get('notifications') || [];
                notifications.forEach(n => n.read = true);
                LMS.storage.set('notifications', notifications);
                this.loadNotifications();
                LMS.showNotification('×›×œ ×”×”×ª×¨××•×ª ×¡×•×× ×• ×›× ×§×¨××•', 'success');
            },
            
            formatTimeAgo(timestamp) {
                const seconds = Math.floor((Date.now() - timestamp) / 1000);
                
                if (seconds < 60) return '×”×¨×’×¢';
                if (seconds < 3600) return `×œ×¤× ×™ ${Math.floor(seconds / 60)} ×“×§×•×ª`;
                if (seconds < 86400) return `×œ×¤× ×™ ${Math.floor(seconds / 3600)} ×©×¢×•×ª`;
                if (seconds < 604800) return `×œ×¤× ×™ ${Math.floor(seconds / 86400)} ×™××™×`;
                
                return new Date(timestamp).toLocaleDateString('he-IL');
            },
            
            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        };
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            Dashboard.init();
        });
    </script>
</body>
</html>

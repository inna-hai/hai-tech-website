<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¦×¤×™×™×” ×‘×§×•×¨×¡ | HAI Tech Academy</title>
    <link rel="stylesheet" href="css/lms.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="course-page">
    <!-- Course Completion Celebration Modal -->
    <div class="celebration-modal" id="celebrationModal" role="dialog" aria-modal="true" aria-labelledby="celebrationTitle">
        <div class="celebration-content">
            <div class="confetti-container" id="confettiContainer"></div>
            <div class="celebration-icon">ğŸ‰</div>
            <h2 id="celebrationTitle">××–×œ ×˜×•×‘!</h2>
            <p id="celebrationText">×¡×™×™××ª ××ª ×”×§×•×¨×¡ ×‘×”×¦×œ×—×”!</p>
            <div class="celebration-stats">
                <div class="stat-item">
                    <span class="stat-value" id="completedLessons">12</span>
                    <span class="stat-label">×©×™×¢×•×¨×™×</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="completedHours">6</span>
                    <span class="stat-label">×©×¢×•×ª</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="completedQuizzes">3</span>
                    <span class="stat-label">×‘×—× ×™×</span>
                </div>
            </div>
            <div class="celebration-certificate">
                <p>×”×ª×¢×•×“×” ×©×œ×š ××•×›× ×”!</p>
                <a href="profile.html#certificates" class="btn btn-primary">×¦×¤×” ×‘×ª×¢×•×“×”</a>
            </div>
            <div class="celebration-actions">
                <button class="btn btn-outline" id="shareCompletion">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"></circle>
                        <circle cx="6" cy="12" r="3"></circle>
                        <circle cx="18" cy="19" r="3"></circle>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    ×©×ª×£ ××ª ×”×”×™×©×’
                </button>
                <a href="catalog.html" class="btn btn-primary">×”××©×š ×œ×œ××•×“</a>
            </div>
            <button class="close-celebration" id="closeCelebration" aria-label="×¡×’×•×¨">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
    </div>
    
    <nav class="lms-navbar course-navbar">
        <div class="navbar-brand">
            <a href="index.html" class="back-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                <span class="back-text">×—×–×¨×” ×œ×§×•×¨×¡×™×</span>
            </a>
        </div>
        <div class="navbar-title" id="courseTitle">
            ××‘×•× ×œ-Machine Learning
        </div>
        <div class="navbar-progress">
            <span id="progressText">0% ×”×•×©×œ×</span>
            <div class="progress-bar-mini">
                <div class="progress-fill" id="progressBar" style="width: 0%"></div>
            </div>
        </div>
        <button class="mobile-lessons-btn" id="mobileLessonsBtn" aria-label="×ª×•×›×Ÿ ×”×§×•×¨×¡">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>
    </nav>
    
    <main class="course-main">
        <!-- Mobile Overlay -->
        <div class="course-overlay" id="courseOverlay"></div>
        
        <aside class="lessons-sidebar" id="lessonsSidebar">
            <div class="sidebar-header">
                <h2>×ª×•×›×Ÿ ×”×§×•×¨×¡</h2>
                <button class="toggle-sidebar" id="closeLessonsSidebar" aria-label="×¡×’×•×¨ ×ª×¤×¨×™×˜">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <!-- Course Overview Card -->
            <div class="course-overview-card">
                <div class="overview-progress">
                    <div class="circular-progress" id="circularProgress">
                        <svg viewBox="0 0 36 36">
                            <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            <path class="circle-progress" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            <text x="18" y="20.35" class="progress-percent">0%</text>
                        </svg>
                    </div>
                    <div class="overview-stats">
                        <span id="completedCount">0</span>/<span id="totalCount">12</span> ×©×™×¢×•×¨×™×
                    </div>
                </div>
            </div>
            
            <div class="lessons-list" id="lessonsList">
                <!-- Lessons loaded dynamically from JSON -->
                <div class="loading-lessons">×˜×•×¢×Ÿ ×©×™×¢×•×¨×™×...</div>
            </div>
        </aside>
        
        <section class="course-content">
            <div class="video-container">
                <div class="video-player" id="videoPlayer">
                    <div class="video-placeholder" id="videoPlaceholder">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        <p>×œ×—×¥ ×œ×”×¤×¢×œ×ª ×”×•×•×™×“××•</p>
                    </div>
                    <video id="lessonVideo" controls style="display: none;">
                        <source src="" type="video/mp4">
                        ×”×“×¤×“×¤×Ÿ ×©×œ×š ×œ× ×ª×•××š ×‘×•×•×™×“××•.
                    </video>
                </div>
                
                <div class="video-info">
                    <div class="video-info-left">
                        <span class="current-module" id="currentModule">××•×“×•×œ 1</span>
                        <span class="separator">â€¢</span>
                        <span class="current-lesson-num" id="currentLessonNum">×©×™×¢×•×¨ 2 ××ª×•×š 12</span>
                    </div>
                    <div class="video-info-right">
                        <button class="video-action-btn" id="bookmarkBtn" title="×”×•×¡×£ ×œ×©××•×¨×™×">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                            </svg>
                        </button>
                        <button class="video-action-btn" id="shareBtn" title="×©×ª×£">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="18" cy="5" r="3"></circle>
                                <circle cx="6" cy="12" r="3"></circle>
                                <circle cx="18" cy="19" r="3"></circle>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="video-controls">
                    <button class="control-btn" id="prevLesson" aria-label="×©×™×¢×•×¨ ×§×•×“×">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="19 20 9 12 19 4 19 20"></polygon>
                            <line x1="5" y1="19" x2="5" y2="5"></line>
                        </svg>
                        <span class="btn-text">×©×™×¢×•×¨ ×§×•×“×</span>
                    </button>
                    <button class="control-btn primary" id="markComplete" aria-label="×¡××Ÿ ×›×”×•×©×œ×">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        <span class="btn-text">×¡××Ÿ ×›×”×•×©×œ×</span>
                    </button>
                    <button class="control-btn" id="nextLesson" aria-label="×©×™×¢×•×¨ ×”×‘×">
                        <span class="btn-text">×©×™×¢×•×¨ ×”×‘×</span>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="5 4 15 12 5 20 5 4"></polygon>
                            <line x1="19" y1="5" x2="19" y2="19"></line>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="content-tabs" role="tablist">
                <button class="content-tab active" data-tab="overview" role="tab" aria-selected="true">×¡×§×™×¨×”</button>
                <button class="content-tab" data-tab="notes" role="tab" aria-selected="false">×”×¢×¨×•×ª ×©×œ×™</button>
                <button class="content-tab" data-tab="resources" role="tab" aria-selected="false">××©××‘×™×</button>
                <button class="content-tab" data-tab="discussion" role="tab" aria-selected="false">×“×™×•×Ÿ</button>
            </div>
            
            <div class="tab-content" id="tabContent">
                <div class="tab-pane active" id="overview" role="tabpanel">
                    <h2 id="lessonTitle">×‘×—×¨ ×©×™×¢×•×¨ ××”×¨×©×™××”</h2>
                    <p id="lessonDescription">
                        ×œ×—×¥ ×¢×œ ×©×™×¢×•×¨ ×‘×¦×“ ×™××™×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ ×œ×œ××•×“
                    </p>
                    
                    <div class="lesson-objectives">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 8v8"></path>
                                <path d="M8 12h8"></path>
                            </svg>
                            ×¢×œ ×”×§×•×¨×¡ ×”×–×”
                        </h3>
                        <ul id="lessonObjectives">
                            <!-- Populated dynamically -->
                        </ul>
                    </div>
                </div>
                
                <div class="tab-pane" id="notes" role="tabpanel">
                    <div class="notes-container">
                        <div class="notes-header">
                            <h3>×”×¢×¨×•×ª ×©×œ×™</h3>
                            <span class="notes-saved-indicator" id="notesSaved" style="display:none">âœ“ × ×©××¨</span>
                        </div>
                        <textarea id="userNotes" placeholder="×¨×©×•× ×›××Ÿ ××ª ×”×”×¢×¨×•×ª ×©×œ×š..." aria-label="×”×¢×¨×•×ª ××™×©×™×•×ª"></textarea>
                        <div class="notes-actions">
                            <button class="btn btn-outline btn-sm" id="downloadNotes">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                ×”×•×¨×“ ×”×¢×¨×•×ª
                            </button>
                            <button class="btn btn-primary btn-sm" id="saveNotes">×©××•×¨ ×”×¢×¨×•×ª</button>
                        </div>
                    </div>
                </div>
                
                <div class="tab-pane" id="resources" role="tabpanel">
                    <h3>××©××‘×™× × ×•×¡×¤×™×</h3>
                    <div class="resources-list" id="resourcesList">
                        <a href="#" class="resource-item" download>
                            <span class="resource-icon">ğŸ“„</span>
                            <div class="resource-info">
                                <span class="resource-title">××¦×’×ª ×”×©×™×¢×•×¨ (PDF)</span>
                                <span class="resource-size">2.3 MB</span>
                            </div>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </a>
                        <a href="#" class="resource-item" download>
                            <span class="resource-icon">ğŸ’»</span>
                            <div class="resource-info">
                                <span class="resource-title">×§×•×“ ×“×•×’××” - Jupyter Notebook</span>
                                <span class="resource-size">1.1 MB</span>
                            </div>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </a>
                        <a href="https://scikit-learn.org" class="resource-item" target="_blank" rel="noopener">
                            <span class="resource-icon">ğŸ”—</span>
                            <div class="resource-info">
                                <span class="resource-title">Scikit-learn Documentation</span>
                                <span class="resource-size">×§×™×©×•×¨ ×—×™×¦×•× ×™</span>
                            </div>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                <polyline points="15 3 21 3 21 9"></polyline>
                                <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <div class="tab-pane" id="discussion" role="tabpanel">
                    <div class="discussion-container">
                        <h3>×“×™×•×Ÿ</h3>
                        <div class="discussion-input">
                            <textarea id="discussionInput" placeholder="×™×© ×œ×š ×©××œ×”? ×›×ª×•×‘ ×›××Ÿ..."></textarea>
                            <button class="btn btn-primary" id="postQuestion">×¤×¨×¡× ×©××œ×”</button>
                        </div>
                        <div class="discussion-list" id="discussionList">
                            <div class="discussion-item">
                                <div class="discussion-avatar">×</div>
                                <div class="discussion-content">
                                    <div class="discussion-header">
                                        <span class="discussion-author">××™×›×œ ×œ.</span>
                                        <span class="discussion-time">×œ×¤× ×™ ×©×¢×ª×™×™×</span>
                                    </div>
                                    <p>×”×× ××¤×©×¨ ×œ×”×¡×‘×™×¨ ×™×•×ª×¨ ×¢×œ ×”×”×‘×“×œ ×‘×™×Ÿ Classification ×œ-Regression?</p>
                                    <div class="discussion-actions">
                                        <button class="discussion-btn">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                                            </svg>
                                            12
                                        </button>
                                        <button class="discussion-btn">×”×’×‘</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- AI Assistant -->
        <aside class="ai-assistant" id="aiAssistant">
            <div class="assistant-header">
                <div class="assistant-avatar">ğŸ¤–</div>
                <div class="assistant-info">
                    <span class="assistant-name">AI ×¢×•×–×¨</span>
                    <span class="assistant-status">××•×›×Ÿ ×œ×¢×–×•×¨</span>
                </div>
                <button class="toggle-assistant" id="toggleAssistant" aria-label="×¡×’×•×¨ ×¢×•×–×¨">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="assistant-suggestions">
                <p>×©××œ×•×ª × ×¤×•×¦×•×ª:</p>
                <button class="suggestion-btn" data-question="××” ×”×”×‘×“×œ ×‘×™×Ÿ supervised ×œ-unsupervised?">××” ×”×”×‘×“×œ ×‘×™×Ÿ supervised ×œ-unsupervised?</button>
                <button class="suggestion-btn" data-question="×ª×Ÿ ×œ×™ ×“×•×’××” ××¢×©×™×ª">×ª×Ÿ ×œ×™ ×“×•×’××” ××¢×©×™×ª</button>
                <button class="suggestion-btn" data-question="×”×¡×‘×¨ ×©×•×‘ ××ª ×”× ×§×•×“×” ×”××—×¨×•× ×”">×”×¡×‘×¨ ×©×•×‘</button>
            </div>
            
            <div class="assistant-chat" id="chatMessages">
                <div class="chat-message assistant">
                    <div class="message-content">
                        ×©×œ×•×! ğŸ‘‹ ×× ×™ ×”×¢×•×–×¨ ×©×œ×š ×‘×§×•×¨×¡. ×™×© ×œ×š ×©××œ×” ×¢×œ ×”×©×™×¢×•×¨?
                    </div>
                </div>
            </div>
            
            <div class="assistant-input">
                <input type="text" id="chatInput" placeholder="×©××œ ×©××œ×”..." aria-label="×©××œ ××ª ×”-AI">
                <button class="send-btn" id="sendMessage" aria-label="×©×œ×—">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </aside>
        
        <button class="open-assistant" id="openAssistant" aria-label="×¤×ª×— ×¢×•×–×¨ AI">
            <span class="assistant-icon">ğŸ¤–</span>
            <span>×©××œ ××ª AI</span>
        </button>
    </main>
    
    <script src="js/lms.js"></script>
    <script>
        // Enhanced Course Viewer
        const CourseViewer = {
            courseId: null,
            courseData: null,
            lessonsData: null,
            currentLesson: null,
            completedLessons: [],
            totalLessons: 12,
            
            async init() {
                // Get course ID from URL
                const urlParams = new URLSearchParams(window.location.search);
                this.courseId = urlParams.get('id') || 'scratch';
                
                // Load course data
                await this.loadCourseData();
                
                // Load progress
                this.loadProgress();
                
                // Render lessons
                this.renderLessons();
                
                // Setup UI
                this.setupModules();
                this.setupLessonNavigation();
                this.setupContentTabs();
                this.setupVideoControls();
                this.setupNotes();
                this.setupAIAssistant();
                this.setupMobileSidebar();
                this.setupCelebration();
                
                // Update UI
                this.updateProgress();
                this.updateLessonStates();
            },
            
            async loadCourseData() {
                try {
                    // Load course info
                    const coursesResponse = await fetch('data/courses.json');
                    const coursesData = await coursesResponse.json();
                    this.courseData = coursesData.courses.find(c => c.id === this.courseId);
                    
                    if (this.courseData) {
                        document.getElementById('courseTitle').textContent = this.courseData.title;
                        document.title = `${this.courseData.title} | HAI Tech Academy`;
                        this.totalLessons = this.courseData.lessonsCount;
                        document.getElementById('totalCount').textContent = this.totalLessons;
                    }
                    
                    // Load lessons
                    try {
                        const lessonsResponse = await fetch(`data/lessons/${this.courseId}.json`);
                        this.lessonsData = await lessonsResponse.json();
                    } catch (e) {
                        console.log('No specific lessons file, using default');
                        this.lessonsData = null;
                    }
                } catch (error) {
                    console.error('Error loading course:', error);
                }
            },
            
            renderLessons() {
                const lessonsList = document.getElementById('lessonsList');
                if (!this.lessonsData || !this.lessonsData.lessons) {
                    lessonsList.innerHTML = '<div class="no-lessons">××™×Ÿ ×©×™×¢×•×¨×™× ×–××™× ×™× ×¢×“×™×™×Ÿ</div>';
                    return;
                }
                
                // Clear existing content
                lessonsList.innerHTML = '';
                
                // Group lessons into modules of 4
                const lessons = this.lessonsData.lessons;
                const modulesCount = Math.ceil(lessons.length / 4);
                
                for (let m = 0; m < modulesCount; m++) {
                    const moduleNum = m + 1;
                    const moduleLessons = lessons.slice(m * 4, (m + 1) * 4);
                    const moduleNames = ['××‘×•× ×•×™×¡×•×“×•×ª', '×”×ª×§×“××•×ª', '××ª×§×“×', '×¤×¨×•×™×§×˜ ×’××¨'];
                    
                    const moduleHtml = `
                        <div class="lesson-module" data-module="${moduleNum}">
                            <button class="module-header" aria-expanded="true">
                                <span class="module-icon">ğŸ“–</span>
                                <div class="module-info">
                                    <span class="module-title">${moduleNames[m] || '××•×“×•×œ ' + moduleNum}</span>
                                    <span class="module-meta">${moduleLessons.length} ×©×™×¢×•×¨×™×</span>
                                </div>
                                <div class="module-progress">
                                    <div class="mini-progress-bar">
                                        <div class="mini-progress-fill" data-progress="0"></div>
                                    </div>
                                </div>
                                <svg class="module-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div class="module-lessons">
                                ${moduleLessons.map((lesson, idx) => `
                                    <a href="#" class="lesson-item ${idx === 0 && m === 0 ? 'active' : ''}" data-lesson="${lesson.id}" data-video="${lesson.videoUrl}">
                                        <span class="lesson-status ${idx === 0 && m === 0 ? 'current' : ''}">
                                            ${idx === 0 && m === 0 ? '<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>' : ''}
                                        </span>
                                        <div class="lesson-info">
                                            <span class="lesson-title">${lesson.title}</span>
                                            <span class="lesson-duration">${lesson.duration || '10:00'}</span>
                                        </div>
                                        <span class="lesson-type" title="×•×™×“××•">ğŸ¬</span>
                                    </a>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    lessonsList.insertAdjacentHTML('beforeend', moduleHtml);
                }
                
                // Update course overview
                this.updateCourseOverview();
                
                // Select first lesson
                const firstLesson = this.lessonsData.lessons[0];
                if (firstLesson) {
                    this.updateLessonContent(firstLesson);
                }
            },
            
            updateCourseOverview() {
                if (!this.courseData) return;
                
                const objectivesList = document.getElementById('lessonObjectives');
                if (objectivesList && this.courseData.topics) {
                    objectivesList.innerHTML = this.courseData.topics.map(topic => 
                        `<li>${topic}</li>`
                    ).join('');
                }
            },
            
            updateLessonContent(lesson) {
                document.getElementById('lessonTitle').textContent = lesson.title;
                document.getElementById('lessonDescription').textContent = lesson.description || '';
                document.getElementById('currentLessonNum').textContent = `×©×™×¢×•×¨ ${lesson.id} ××ª×•×š ${this.totalLessons}`;
            },
            
            loadProgress() {
                const progress = LMS.storage.get('progress') || {};
                const courseProgress = progress[this.courseId] || { completed: [], currentLesson: 1 };
                
                this.completedLessons = courseProgress.completed || [];
                this.currentLesson = courseProgress.currentLesson || 1;
            },
            
            saveProgress() {
                const progress = LMS.storage.get('progress') || {};
                progress[this.courseId] = {
                    completed: this.completedLessons,
                    currentLesson: this.currentLesson
                };
                LMS.storage.set('progress', progress);
            },
            
            setupModules() {
                const moduleHeaders = document.querySelectorAll('.module-header');
                
                moduleHeaders.forEach(header => {
                    header.addEventListener('click', () => {
                        const lessons = header.nextElementSibling;
                        const isCollapsed = lessons.classList.contains('collapsed');
                        
                        lessons.classList.toggle('collapsed');
                        header.setAttribute('aria-expanded', isCollapsed);
                        
                        // Animate arrow
                        const arrow = header.querySelector('.module-arrow');
                        arrow.style.transform = isCollapsed ? 'rotate(0)' : 'rotate(180deg)';
                    });
                });
            },
            
            setupLessonNavigation() {
                const lessonItems = document.querySelectorAll('.lesson-item');
                
                lessonItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        
                        // Check if locked
                        if (item.classList.contains('locked')) {
                            const requires = item.dataset.requires;
                            LMS.showNotification(`×™×© ×œ×”×©×œ×™× ×§×•×“× ××ª ×©×™×¢×•×¨ ${requires} ×›×“×™ ×œ×¤×ª×•×— ×©×™×¢×•×¨ ×–×”`, 'warning');
                            return;
                        }
                        
                        this.navigateToLesson(item);
                    });
                });
            },
            
            navigateToLesson(item) {
                const lessonId = parseInt(item.dataset.lesson);
                
                // Update active state
                document.querySelectorAll('.lesson-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                
                // Update current status
                document.querySelectorAll('.lesson-status.current').forEach(s => {
                    if (!s.classList.contains('completed')) {
                        s.classList.remove('current');
                        s.innerHTML = '';
                    }
                });
                
                const status = item.querySelector('.lesson-status');
                if (status && !status.classList.contains('completed')) {
                    status.classList.add('current');
                    status.innerHTML = `
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                    `;
                }
                
                // Get lesson data from JSON
                const lessonData = this.lessonsData?.lessons?.find(l => l.id === lessonId);
                if (lessonData) {
                    this.updateLessonContent(lessonData);
                } else {
                    // Fallback to HTML content
                    const title = item.querySelector('.lesson-title').textContent;
                    document.getElementById('lessonTitle').textContent = title;
                    document.getElementById('currentLessonNum').textContent = `×©×™×¢×•×¨ ${lessonId} ××ª×•×š ${this.totalLessons}`;
                }
                
                // Find module
                const module = item.closest('.lesson-module');
                const moduleTitle = module?.querySelector('.module-title')?.textContent || '';
                document.getElementById('currentModule').textContent = moduleTitle;
                
                // Expand parent module if collapsed
                const moduleLessons = item.closest('.module-lessons');
                if (moduleLessons?.classList.contains('collapsed')) {
                    moduleLessons.classList.remove('collapsed');
                    const header = moduleLessons.previousElementSibling;
                    header?.setAttribute('aria-expanded', 'true');
                }
                
                this.currentLesson = lessonId;
                this.saveProgress();
                
                // Scroll lesson into view on mobile
                if (window.innerWidth <= 768) {
                    document.getElementById('lessonsSidebar').classList.remove('visible');
                    document.getElementById('courseOverlay').classList.remove('visible');
                }
            },
            
            setupContentTabs() {
                const tabs = document.querySelectorAll('.content-tab');
                const panes = document.querySelectorAll('.tab-pane');
                
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        tabs.forEach(t => {
                            t.classList.remove('active');
                            t.setAttribute('aria-selected', 'false');
                        });
                        panes.forEach(p => p.classList.remove('active'));
                        
                        tab.classList.add('active');
                        tab.setAttribute('aria-selected', 'true');
                        
                        const pane = document.getElementById(tab.dataset.tab);
                        if (pane) pane.classList.add('active');
                    });
                });
            },
            
            setupVideoControls() {
                const markComplete = document.getElementById('markComplete');
                const prevLesson = document.getElementById('prevLesson');
                const nextLesson = document.getElementById('nextLesson');
                const videoPlaceholder = document.getElementById('videoPlaceholder');
                
                markComplete?.addEventListener('click', () => this.markLessonComplete());
                prevLesson?.addEventListener('click', () => this.navigateLessonByDirection('prev'));
                nextLesson?.addEventListener('click', () => this.navigateLessonByDirection('next'));
                
                videoPlaceholder?.addEventListener('click', () => {
                    LMS.showNotification('×”×•×•×™×“××• ×™×”×™×” ×–××™×Ÿ ×‘×§×¨×•×‘!', 'info');
                });
            },
            
            markLessonComplete() {
                const activeLesson = document.querySelector('.lesson-item.active');
                if (!activeLesson) return;
                
                const lessonId = activeLesson.dataset.lesson;
                
                if (!this.completedLessons.includes(lessonId)) {
                    this.completedLessons.push(lessonId);
                    this.saveProgress();
                    
                    // Update UI
                    activeLesson.classList.add('completed');
                    const status = activeLesson.querySelector('.lesson-status');
                    if (status) {
                        status.classList.remove('current');
                        status.classList.add('completed');
                        status.innerHTML = `
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        `;
                    }
                    
                    // Unlock next lesson
                    this.unlockNextLessons();
                    
                    // Update progress
                    this.updateProgress();
                    
                    // Check if course completed
                    if (this.completedLessons.length >= this.totalLessons) {
                        this.showCelebration();
                    } else {
                        LMS.showNotification('×”×©×™×¢×•×¨ ×¡×•××Ÿ ×›×”×•×©×œ×! ğŸ‰', 'success');
                        
                        // Auto-advance to next
                        setTimeout(() => this.navigateLessonByDirection('next'), 1000);
                    }
                    
                    // Log activity
                    this.logActivity('lesson', `×”×©×œ××ª ×©×™×¢×•×¨: ${activeLesson.querySelector('.lesson-title').textContent}`);
                }
            },
            
            unlockNextLessons() {
                document.querySelectorAll('.lesson-item.locked').forEach(item => {
                    const requires = item.dataset.requires;
                    if (requires && this.completedLessons.includes(requires)) {
                        item.classList.remove('locked');
                        const status = item.querySelector('.lesson-status');
                        if (status) {
                            status.classList.remove('locked');
                            status.innerHTML = '';
                        }
                    }
                });
            },
            
            navigateLessonByDirection(direction) {
                const lessons = Array.from(document.querySelectorAll('.lesson-item:not(.locked)'));
                const activeIndex = lessons.findIndex(l => l.classList.contains('active'));
                
                let newIndex;
                if (direction === 'prev') {
                    newIndex = Math.max(0, activeIndex - 1);
                } else {
                    newIndex = Math.min(lessons.length - 1, activeIndex + 1);
                }
                
                if (newIndex !== activeIndex && lessons[newIndex]) {
                    this.navigateToLesson(lessons[newIndex]);
                }
            },
            
            updateProgress() {
                const completed = this.completedLessons.length;
                const percentage = Math.round((completed / this.totalLessons) * 100);
                
                // Update navbar progress
                document.getElementById('progressBar').style.width = `${percentage}%`;
                document.getElementById('progressText').textContent = `${percentage}% ×”×•×©×œ×`;
                
                // Update circular progress
                const circle = document.querySelector('.circle-progress');
                if (circle) {
                    circle.setAttribute('stroke-dasharray', `${percentage}, 100`);
                }
                const progressPercent = document.querySelector('.progress-percent');
                if (progressPercent) {
                    progressPercent.textContent = `${percentage}%`;
                }
                
                // Update counts
                document.getElementById('completedCount').textContent = completed;
                document.getElementById('totalCount').textContent = this.totalLessons;
                
                // Update module progress bars
                this.updateModuleProgress();
            },
            
            updateModuleProgress() {
                document.querySelectorAll('.lesson-module').forEach(module => {
                    const lessons = module.querySelectorAll('.lesson-item');
                    const completed = module.querySelectorAll('.lesson-item.completed').length;
                    const percentage = Math.round((completed / lessons.length) * 100);
                    
                    const progressFill = module.querySelector('.mini-progress-fill');
                    if (progressFill) {
                        progressFill.style.width = `${percentage}%`;
                    }
                });
            },
            
            updateLessonStates() {
                // Mark completed lessons
                this.completedLessons.forEach(lessonId => {
                    const item = document.querySelector(`[data-lesson="${lessonId}"]`);
                    if (item) {
                        item.classList.add('completed');
                        item.classList.remove('locked');
                        
                        const status = item.querySelector('.lesson-status');
                        if (status) {
                            status.classList.add('completed');
                            status.classList.remove('locked', 'current');
                            status.innerHTML = `
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            `;
                        }
                    }
                });
                
                // Unlock lessons based on prerequisites
                this.unlockNextLessons();
            },
            
            setupNotes() {
                const textarea = document.getElementById('userNotes');
                const saveBtn = document.getElementById('saveNotes');
                const downloadBtn = document.getElementById('downloadNotes');
                const savedIndicator = document.getElementById('notesSaved');
                
                // Load notes
                const notes = LMS.storage.get('notes') || {};
                if (textarea && notes[this.courseId]) {
                    textarea.value = notes[this.courseId];
                }
                
                // Save notes
                const saveNotes = () => {
                    const allNotes = LMS.storage.get('notes') || {};
                    allNotes[this.courseId] = textarea.value;
                    LMS.storage.set('notes', allNotes);
                    
                    savedIndicator.style.display = 'inline';
                    setTimeout(() => savedIndicator.style.display = 'none', 2000);
                };
                
                saveBtn?.addEventListener('click', () => {
                    saveNotes();
                    LMS.showNotification('×”×”×¢×¨×•×ª × ×©××¨×•!', 'success');
                });
                
                // Auto-save
                let saveTimeout;
                textarea?.addEventListener('input', () => {
                    clearTimeout(saveTimeout);
                    saveTimeout = setTimeout(saveNotes, 1000);
                });
                
                // Download notes
                downloadBtn?.addEventListener('click', () => {
                    const text = textarea.value;
                    const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `notes-${this.courseId}.txt`;
                    a.click();
                    URL.revokeObjectURL(url);
                });
            },
            
            setupAIAssistant() {
                const assistant = document.getElementById('aiAssistant');
                const toggleBtn = document.getElementById('toggleAssistant');
                const openBtn = document.getElementById('openAssistant');
                const sendBtn = document.getElementById('sendMessage');
                const chatInput = document.getElementById('chatInput');
                const suggestions = document.querySelectorAll('.suggestion-btn');
                
                toggleBtn?.addEventListener('click', () => {
                    assistant.classList.add('hidden');
                    openBtn.style.display = 'flex';
                });
                
                openBtn?.addEventListener('click', () => {
                    assistant.classList.remove('hidden');
                    openBtn.style.display = 'none';
                    chatInput?.focus();
                });
                
                const sendMessage = () => {
                    const message = chatInput?.value.trim();
                    if (!message) return;
                    
                    this.addChatMessage(message, 'user');
                    chatInput.value = '';
                    
                    // Simulate AI response
                    setTimeout(() => {
                        const responses = [
                            '×©××œ×” ××¢× ×™×™× ×ª! ×‘×•× × ×¢×‘×•×¨ ×¢×œ ×–×” ×‘×™×—×“. Supervised Learning ××©×ª××© ×‘× ×ª×•× ×™× ××ª×•×™×’×™× - ×›×œ×•××¨, ×× ×—× ×• ×™×•×“×¢×™× ××” ×”×ª×©×•×‘×” ×”× ×›×•× ×”. Unsupervised Learning ×œ×¢×•××ª ×–××ª, ×× ×¡×” ×œ××¦×•× ×“×¤×•×¡×™× ×‘× ×ª×•× ×™× ×œ×œ× ×ª×™×•×’ ××•×§×“×.',
                            '× ×§×•×“×” ×˜×•×‘×”! ×œ××©×œ, ×× ×× ×—× ×• ×¨×•×¦×™× ×œ×–×”×•×ª ×”×× ×ª××•× ×” ××›×™×œ×” ×—×ª×•×œ ××• ×›×œ×‘ - ×–×” Classification (Supervised). ×× ×× ×—× ×• ×¨×•×¦×™× ×œ×§×‘×¥ ×œ×§×•×—×•×ª ×œ×¤×™ ×”×ª× ×”×’×•×ª ×§× ×™×™×” - ×–×” Clustering (Unsupervised).',
                            '×‘×”×—×œ×˜! ×”×›×œ×œ ×”×¤×©×•×˜ ×”×•×: ×™×© ×œ×š × ×ª×•× ×™× ××ª×•×™×’×™×? â†’ Supervised. ××™×Ÿ ×ª×™×•×’ ×•××ª×” ××—×¤×© ××‘× ×”? â†’ Unsupervised.',
                            '××©××— ×œ×”×¨×—×™×‘! Regression ××©××© ×›×©×”×ª×•×¦××” ×”×™× ××¡×¤×¨ ×¨×¦×™×£ (×›××• ××—×™×¨), Classification ×›×©×”×ª×•×¦××” ×”×™× ×§×˜×’×•×¨×™×” (×›××• ×¡×¤××/×œ× ×¡×¤××).'
                        ];
                        const response = responses[Math.floor(Math.random() * responses.length)];
                        this.addChatMessage(response, 'assistant');
                    }, 1000);
                };
                
                sendBtn?.addEventListener('click', sendMessage);
                chatInput?.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendMessage();
                });
                
                // Suggestion buttons
                suggestions.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const question = btn.dataset.question;
                        chatInput.value = question;
                        sendMessage();
                    });
                });
            },
            
            addChatMessage(text, type) {
                const chat = document.getElementById('chatMessages');
                if (!chat) return;
                
                const message = document.createElement('div');
                message.className = `chat-message ${type}`;
                message.innerHTML = `<div class="message-content">${text}</div>`;
                
                chat.appendChild(message);
                chat.scrollTop = chat.scrollHeight;
            },
            
            setupMobileSidebar() {
                const sidebar = document.getElementById('lessonsSidebar');
                const overlay = document.getElementById('courseOverlay');
                const openBtn = document.getElementById('mobileLessonsBtn');
                const closeBtn = document.getElementById('closeLessonsSidebar');
                
                const toggleSidebar = (show) => {
                    sidebar.classList.toggle('visible', show);
                    overlay.classList.toggle('visible', show);
                };
                
                openBtn?.addEventListener('click', () => toggleSidebar(true));
                closeBtn?.addEventListener('click', () => toggleSidebar(false));
                overlay?.addEventListener('click', () => toggleSidebar(false));
            },
            
            setupCelebration() {
                const modal = document.getElementById('celebrationModal');
                const closeBtn = document.getElementById('closeCelebration');
                const shareBtn = document.getElementById('shareCompletion');
                
                closeBtn?.addEventListener('click', () => {
                    modal.classList.remove('visible');
                });
                
                shareBtn?.addEventListener('click', () => {
                    if (navigator.share) {
                        navigator.share({
                            title: '×¡×™×™××ª×™ ×§×•×¨×¡ ×‘-HAI Tech Academy!',
                            text: '×–×” ×¢×ª×” ×¡×™×™××ª×™ ×§×•×¨×¡ Machine Learning ×‘-HAI Tech Academy! ğŸ‰',
                            url: window.location.href
                        });
                    } else {
                        navigator.clipboard.writeText(window.location.href);
                        LMS.showNotification('×”×§×™×©×•×¨ ×”×•×¢×ª×§!', 'success');
                    }
                });
            },
            
            showCelebration() {
                const modal = document.getElementById('celebrationModal');
                
                // Update stats
                document.getElementById('completedLessons').textContent = this.totalLessons;
                document.getElementById('completedHours').textContent = '6';
                document.getElementById('completedQuizzes').textContent = '3';
                
                // Show modal
                modal.classList.add('visible');
                
                // Create confetti
                this.createConfetti();
                
                // Log activity
                this.logActivity('certificate', '×§×™×‘×œ×ª ×ª×¢×•×“×”: Machine Learning');
                
                // Save certificate
                const certificates = LMS.storage.get('certificates') || [];
                if (!certificates.find(c => c.courseId === this.courseId)) {
                    certificates.push({
                        courseId: this.courseId,
                        title: document.getElementById('courseTitle').textContent,
                        completedAt: new Date().toISOString()
                    });
                    LMS.storage.set('certificates', certificates);
                }
            },
            
            createConfetti() {
                const container = document.getElementById('confettiContainer');
                const colors = ['#667eea', '#764ba2', '#f59e0b', '#22c55e', '#ef4444', '#3b82f6'];
                
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.cssText = `
                        left: ${Math.random() * 100}%;
                        background: ${colors[Math.floor(Math.random() * colors.length)]};
                        animation-delay: ${Math.random() * 3}s;
                        animation-duration: ${3 + Math.random() * 2}s;
                    `;
                    container.appendChild(confetti);
                }
                
                // Remove confetti after animation
                setTimeout(() => {
                    container.innerHTML = '';
                }, 6000);
            },
            
            logActivity(type, text) {
                const activities = LMS.storage.get('activities') || [];
                activities.unshift({
                    type,
                    text,
                    time: Date.now()
                });
                LMS.storage.set('activities', activities.slice(0, 50));
            }
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            CourseViewer.init();
        });
    </script>
</body>
</html>
